!function(){var t,e,r,n,a,o,i,s,u,l,c,p,h,g,f,d,v,m=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1},b=[].slice,y={}.hasOwnProperty,w=function(t,e){return function(){return t.apply(e,arguments)}};t=jQuery,r=function(t){var e,r,n,a;for(t+="",r=t.split("."),n=r[0],a=r.length>1?"."+r[1]:"",e=/(\d+)(\d{3})/;e.test(n);)n=n.replace(e,"$1,$2");return n+a},g=function(t,e){return null==t&&(t=3),null==e&&(e=1),function(n){return 0===n||isNaN(n)||!isFinite(n)?"":r((e*n).toFixed(t))}},n={sum:function(t,e){return null==t&&(t=3),null==e&&(e=1),function(r){var n;return n=r[0],function(){return{sum:0,push:function(t){return isNaN(parseFloat(t[n]))?void 0:this.sum+=parseFloat(t[n])},value:function(){return this.sum},format:g(t,e)}}}},average:function(t,e){return null==t&&(t=3),null==e&&(e=1),function(r){var n;return n=r[0],function(){return{sum:0,len:0,push:function(t){return isNaN(parseFloat(t[n]))?void 0:(this.sum+=parseFloat(t[n]),this.len++)},value:function(){return this.sum/this.len},format:g(t,e)}}}},sumOverSum:function(t,e){return null==t&&(t=3),null==e&&(e=1),function(r){var n,a;return a=r[0],n=r[1],function(){return{sumNum:0,sumDenom:0,push:function(t){return isNaN(parseFloat(t[a]))||(this.sumNum+=parseFloat(t[a])),isNaN(parseFloat(t[n]))?void 0:this.sumDenom+=parseFloat(t[n])},value:function(){return this.sumNum/this.sumDenom},format:g(t,e)}}}},sumOverSumBound80:function(t,e,r){return null==t&&(t=3),null==e&&(e=1),null==r&&(r=!0),function(n){var a,o;return o=n[0],a=n[1],function(){return{sumNum:0,sumDenom:0,push:function(t){return isNaN(parseFloat(t[o]))||(this.sumNum+=parseFloat(t[o])),isNaN(parseFloat(t[a]))?void 0:this.sumDenom+=parseFloat(t[a])},value:function(){var t;return t=r?1:-1,(.821187207574908/this.sumDenom+this.sumNum/this.sumDenom+1.2815515655446004*t*Math.sqrt(.410593603787454/(this.sumDenom*this.sumDenom)+this.sumNum*(1-this.sumNum/this.sumDenom)/(this.sumDenom*this.sumDenom)))/(1+1.642374415149816/this.sumDenom)},format:g(t,e)}}}}},a={count:function(){return function(){return{count:0,push:function(){return this.count++},value:function(){return this.count},format:g(0)}}},countUnique:function(t){var e;return e=t[0],function(){return{uniq:[],push:function(t){var r;return r=t[e],m.call(this.uniq,r)<0?this.uniq.push(t[e]):void 0},value:function(){return this.uniq.length},format:g(0)}}},listUnique:function(t){var e;return e=t[0],function(){return{uniq:[],push:function(t){var r;return r=t[e],m.call(this.uniq,r)<0?this.uniq.push(t[e]):void 0},value:function(){return this.uniq.join(", ")},format:function(t){return t}}}},intSum:n.sum(0),sum:n.sum(3),average:n.average(3),sumOverSum:n.sumOverSum(3),ub80:n.sumOverSumBound80(3,1,!0),lb80:n.sumOverSumBound80(3,1,!1)},f={},c={bin:function(t,e){var r;return r="string"==typeof t?function(e){return e[t]}:t,function(t){return""+(r(t)-r(t)%e)}}},h={current:null,ln:function(){var t;return null!=(t=h.current)?t:h.current=window.navigator.userLanguage||window.navigator.language},t:function(){var t,e,r,n,a;return n=arguments[0],t=2<=arguments.length?b.call(arguments,1):[],r=null!=(a=h[h.ln()])?a:h.en,e=null!=r?r[n]:void 0,null!=e?"[object Function]"===Object.prototype.toString.call(e)?e(t):e:n}},h.en={"values for axis":function(t){return""+t[0]+" values for "+t[1]},"aggregator.count":"count","aggregator.countUnique":"countUnique","aggregator.listUnique":"listUnique","aggregator.intSum":"intSum","aggregator.sum":"Sum","aggregator.average":"average","aggregator.sumOverSum":"sumOverSum","aggregator.ub80":"ub80","aggregator.lb80":"lb80"},v=h.t,u={style:"jquery-ui",decorate:function(t,e){return u["default"][e](t),u[u.style][e](t)}},t.pivotUtilities={aggregatorTemplates:n,aggregators:a,renderers:f,derivers:c,i18n:h,decorators:u},l=function(t,e,r){var n,a,o;for(n in e)a=e[n],t[n]=null!=(o=a(t))?o:t[n];for(n in t)y.call(t,n)&&null==t[n]&&(t[n]=v("null"));return r(t)},p=function(e,r,n){var a,o,i,s,u,c,p,h,g,f,d,v;if(a=function(t){return l(t,r,n)},"[object Function]"===Object.prototype.toString.call(e))return e(a);if(Array.isArray(e)){if(Array.isArray(e[0])){d=[];for(i in e)if(y.call(e,i)&&(o=e[i],i>0)){c={},f=e[0];for(s in f)y.call(f,s)&&(u=f[s],c[u]=o[s]);d.push(a(c))}return d}for(v=[],h=0,g=e.length;g>h;h++)c=e[h],v.push(a(c));return v}return p=[],t("thead > tr > th",e).each(function(){return p.push(t(this).text())}),t("tbody > tr",e).each(function(){return c={},t("td",this).each(function(e){return c[p[e]]=t(this).text()}),a(c)})},s=function(t){var e;return e=[],p(t,{},function(t){return e.push(t)}),e},e=function(){function t(t,e,r){this.aggregator=t,this.colVars=e,this.rowVars=r,this.getAggregator=w(this.getAggregator,this),this.flattenKey=w(this.flattenKey,this),this.getRowKeys=w(this.getRowKeys,this),this.getColKeys=w(this.getColKeys,this),this.sortKeys=w(this.sortKeys,this),this.arrSort=w(this.arrSort,this),this.natSort=w(this.natSort,this),this.tree={},this.rowKeys=[],this.colKeys=[],this.flatRowKeys=[],this.flatColKeys=[],this.rowTotals={},this.colTotals={},this.allTotal=this.aggregator(),this.sorted=!1}return t.prototype.natSort=function(t,e){var r,n,a,o,i,s,u;if(s=/(\d+)|(\D+)/g,i=/\d/,u=/^0/,"number"==typeof t||"number"==typeof e)return isNaN(t)?1:isNaN(e)?-1:t-e;if(r=String(t).toLowerCase(),a=String(e).toLowerCase(),r===a)return 0;if(!i.test(r)||!i.test(a))return r>a?1:-1;for(r=r.match(s),a=a.match(s);r.length&&a.length;)if(n=r.shift(),o=a.shift(),n!==o)return i.test(n)&&i.test(o)?n.replace(u,".0")-o.replace(u,".0"):n>o?1:-1;return r.length-a.length},t.prototype.arrSort=function(t,e){return this.natSort(t.join(),e.join())},t.prototype.sortKeys=function(){return this.sorted||(this.rowKeys.sort(this.arrSort),this.colKeys.sort(this.arrSort)),this.sorted=!0},t.prototype.getColKeys=function(){return this.sortKeys(),this.colKeys},t.prototype.getRowKeys=function(){return this.sortKeys(),this.rowKeys},t.prototype.flattenKey=function(t){return t.join(String.fromCharCode(0))},t.prototype.processRow=function(t){var e,r,n,a,o;return e=function(){var e,r,n,a;for(n=this.colVars,a=[],e=0,r=n.length;r>e;e++)o=n[e],a.push(t[o]);return a}.call(this),a=function(){var e,r,n,a;for(n=this.rowVars,a=[],e=0,r=n.length;r>e;e++)o=n[e],a.push(t[o]);return a}.call(this),n=this.flattenKey(a),r=this.flattenKey(e),this.allTotal.push(t),0!==a.length&&(m.call(this.flatRowKeys,n)<0&&(this.rowKeys.push(a),this.flatRowKeys.push(n)),this.rowTotals[n]||(this.rowTotals[n]=this.aggregator()),this.rowTotals[n].push(t)),0!==e.length&&(m.call(this.flatColKeys,r)<0&&(this.colKeys.push(e),this.flatColKeys.push(r)),this.colTotals[r]||(this.colTotals[r]=this.aggregator()),this.colTotals[r].push(t)),0!==e.length&&0!==a.length?(n in this.tree||(this.tree[n]={}),r in this.tree[n]||(this.tree[n][r]=this.aggregator()),this.tree[n][r].push(t)):void 0},t.prototype.getAggregator=function(t,e){var r,n,a;return a=this.flattenKey(t),n=this.flattenKey(e),r=0===t.length&&0===e.length?this.allTotal:0===t.length?this.colTotals[n]:0===e.length?this.rowTotals[a]:this.tree[a][n],null!=r?r:{value:function(){return null},format:function(){return""}}},t}(),o=function(t,r,n,a,o,i){var s;return s=new e(a,r,n),p(t,i,function(t){return o(t)?s.processRow(t):void 0}),window.pivotData=s,s},d=function(t,e,r){var n,a,o,i,s,u;if(0!==e){for(a=!0,i=s=0;r>=0?r>=s:s>=r;i=r>=0?++s:--s)t[e-1][i]!==t[e][i]&&(a=!1);if(a)return-1}for(n=0;e+n<t.length;){for(o=!1,i=u=0;r>=0?r>=u:u>=r;i=r>=0?++u:--u)t[e][i]!==t[e+n][i]&&(o=!0);if(o)break;n++}return n},i=function(e){var r,n,a,o,i,s,l,c,p,h,g,f,m,b,w,x,T,N;i=e.colVars,f=e.rowVars,g=e.getRowKeys(),o=e.getColKeys(),p=t("<table class='pvtTable'>");for(l in i)if(y.call(i,l)){n=i[l],w=t("<tr>"),0===parseInt(l)&&0!==f.length&&w.append(t("<th>").attr("colspan",f.length).attr("rowspan",i.length)),w.append(t("<th class='pvtAxisLabel'>").text(n));for(s in o)y.call(o,s)&&(a=o[s],N=d(o,parseInt(s),parseInt(l)),-1!==N&&(m=t("<th class='pvtColLabel col"+s+"'>").text(a[l]).attr("colspan",N),parseInt(l)===i.length-1&&0!==f.length&&m.attr("rowspan",2),w.append(m)));0===parseInt(l)&&w.append(t("<th class='pvtTotalLabel'>").text(v("Totals")).attr("rowspan",i.length+(0===f.length?0:1))),p.append(w)}if(0!==f.length){w=t("<tr>");for(s in f)y.call(f,s)&&(c=f[s],w.append(t("<th class='pvtAxisLabel'>").text(c)));m=t("<th>"),0===i.length&&m.addClass("pvtTotalLabel").text(v("Totals")),w.append(m),p.append(w)}for(s in g)if(y.call(g,s)){h=g[s],w=t("<tr>");for(l in h)y.call(h,l)&&(x=h[l],N=d(g,parseInt(s),parseInt(l)),-1!==N&&(m=t("<th class='pvtRowLabel row"+s+"'>").text(x).attr("rowspan",N),parseInt(l)===f.length-1&&0!==i.length&&m.attr("colspan",2),w.append(m)));for(l in o)y.call(o,l)&&(a=o[l],r=e.getAggregator(h,a),T=r.value(),w.append(t("<td class='pvtVal row"+s+" col"+l+"'>").text(r.format(T)).data("value",T)));b=e.getAggregator(h,[]),T=b.value(),w.append(t("<td class='pvtTotal rowTotal row"+s+"'>").text(b.format(T)).data("value",T).data("for","row"+s)),p.append(w)}w=t("<tr>"),m=t("<th class='pvtTotalLabel'>").text(v("Totals")),m.attr("colspan",f.length+(0===i.length?0:1)),w.append(m);for(l in o)y.call(o,l)&&(a=o[l],b=e.getAggregator([],a),T=b.value(),w.append(t("<td class='pvtTotal colTotal col"+l+"'>").text(b.format(T)).data("value",T).data("for","col"+l)));return b=e.getAggregator([],[]),T=b.value(),w.append(t("<td class='pvtGrandTotal'>").text(b.format(T)).data("value",T)),p.append(w),p.data("dimensions",[g.length,o.length]),u.decorate(p,"PivotTable"),p},t.fn.pivot=function(e,r){var n,s;return n={cols:[],rows:[],filter:function(){return!0},aggregator:a.count(),derivedAttributes:{},renderer:function(t){return i(t)}},r=t.extend(n,r),s=o(e,r.cols,r.rows,r.aggregator,r.filter,r.derivedAttributes),this.html(r.renderer(s)),this},t.fn.pivotUI=function(e,r){var n,o,i,u,l,c,h,g,d,b,w,x,T,N,K,S,A,C,k,F,V,j,q,D,P,O,R,L,U,H,I,M,_,z,B;c={derivedAttributes:{},aggregators:a,renderers:f,hiddenAxes:[],cols:[],rows:[],vals:[]},r=t.extend(c,r),e=s(e),T=function(){var t,r;t=e[0],r=[];for(g in t)y.call(t,g)&&r.push(g);return r}(),I=r.derivedAttributes;for(i in I)y.call(I,i)&&m.call(T,i)<0&&T.push(i);for(o={},k=0,q=T.length;q>k;k++)A=T[k],o[A]={};if(p(e,r.derivedAttributes,function(t){var e,r,n;n=[];for(g in t)y.call(t,g)&&(e=t[g],null==e&&(e="null"),null==(r=o[g])[e]&&(r[e]=0),n.push(o[g][e]++));return n}),S=t("<table class='table table-bordered' cellpadding='5'>"),x=function(){var t,e;t=r.renderers,e=[];for(A in t)y.call(t,A)&&(C=t[A],e.push(A));return e}(),0!==x.length){for(x.unshift("None"),l=t("<td colspan='2' align='center'>"),h=t("<form>").addClass("form-inline"),l.append(h),h.append(t("<strong>").text(v("Effects:"))),F=0,D=x.length;D>F;F++)A=x[F],b=t("<input type='radio' name='renderers' id='renderers_"+A.replace(/\s/g,"")+"'>").css({"margin-left":"15px","margin-right":"5px"}).val(A),"None"===A&&b.attr("checked","checked"),h.append(b).append(t("<label class='checkbox inline' for='renderers_"+A.replace(/\s/g,"")+"'>").text(v(A)));S.append(t("<tr>").append(l))}for(u=t("<td colspan='2' id='unused' class='pvtAxisContainer pvtHorizList'>"),V=0,P=T.length;P>V;V++)i=T[V],m.call(r.hiddenAxes,i)<0&&function(e){var r,n,a,i,s,l,c,p,h;if(i=Object.keys(o[e]).length,n=t("<nobr>").text(e),l=t("<div>").css({"z-index":100,width:"280px",height:"350px",overflow:"scroll",border:"1px solid gray",background:"white",display:"none",position:"absolute",padding:"20px"}),l.append(t("<strong>").text(v("values for axis",i,e))),i>20)l.append(t("<p>").text(v("(too many to list)")));else for(r=t("<p>"),r.append(t("<button>").text(v("Select All")).bind("click",function(){return l.find("input").attr("checked",!0)})),r.append(t("<button>").text(v("Select None")).bind("click",function(){return l.find("input").attr("checked",!1)})),l.append(r),h=Object.keys(o[e]).sort(),c=0,p=h.length;p>c;c++)g=h[c],s=o[e][g],a=t("<label>"),a.append(t("<input type='checkbox' class='pvtFilter'>").attr("checked",!0).data("filter",[e,g])),a.append(t("<span>").text(""+g+" ("+s+")")),l.append(t("<p>").append(a));return n.bind("dblclick",function(e){return l.css({left:e.pageX,top:e.pageY}).toggle(),l.bind("click",function(t){return t.stopPropagation()}),t(document).one("click",function(){return w(),l.toggle()})}),u.append(t("<li class='label label-info' id='axis_"+e.replace(/\s/g,"")+"'>").append(n).append(l))}(i);S.append(t("<tr>").append(u)),N=t("<tr>"),n=t("<select id='aggregator'>").css("margin-bottom","5px").bind("change",function(){return w()}),M=r.aggregators;for(A in M)y.call(M,A)&&n.append(t("<option>").val(A).text(v("aggregator."+A)));for(N.append(t("<td id='vals' class='pvtAxisContainer pvtHorizList'>").css("text-align","center").append(n).append(t("<br>"))),N.append(t("<td id='cols' class='pvtAxisContainer pvtHorizList'>")),S.append(N),K=t("<tr>"),K.append(t("<td valign='top' id='rows' class='pvtAxisContainer'>")),d=t("<td valign='top'>"),K.append(d),S.append(K),this.html(S),_=r.cols,j=0,O=_.length;O>j;j++)A=_[j],t("#cols").append(t("#axis_"+A.replace(/\s/g,"")));for(z=r.rows,U=0,R=z.length;R>U;U++)A=z[U],t("#rows").append(t("#axis_"+A.replace(/\s/g,"")));for(B=r.vals,H=0,L=B.length;L>H;H++)A=B[H],t("#vals").append(t("#axis_"+A.replace(/\s/g,"")));return null!=r.aggregatorName&&t("#aggregator").val(r.aggregatorName),null!=r.rendererName&&t("#renderers_"+r.rendererName.replace(/\s/g,"")).attr("checked",!0),w=function(){var a,o,i,s;return i={derivedAttributes:r.derivedAttributes},i.cols=[],i.rows=[],s=[],t("#rows li nobr").each(function(){return i.rows.push(t(this).text())}),t("#cols li nobr").each(function(){return i.cols.push(t(this).text())}),t("#vals li nobr").each(function(){return s.push(t(this).text())}),i.aggregator=r.aggregators[n.val()](s),a=[],t("input.pvtFilter").not(":checked").each(function(){return a.push(t(this).data("filter"))}),i.filter=function(t){var e,r,n,o;for(n=0,r=a.length;r>n;n++)if(o=a[n],g=o[0],e=o[1],t[g]===e)return!1;return!0},0!==x.length&&(o=t("input[name=renderers]:checked").val(),"None"!==o&&(i.renderer=r.renderers[o])),d.pivot(e,i)},w(),t("input[name=renderers]").bind("change",w),t(".pvtAxisContainer").sortable({connectWith:".pvtAxisContainer",items:"li"}).bind("sortstop",w),this},window.PivotTable=t.extend(t.pivotUtilities,{deriveAttributes:l,buildPivotData:o,buildPivotTable:i,forEachRow:p,PivotData:e})}.call(this),function(){var t,e,r;t=jQuery,r=window.PivotTable,e=r.decorators,e["default"]={PivotTable:function(e){return t(".pvtVal, .pvtTotal",e).hover(function(){var r;return r="."+t.trim(t(this)[0].className.replace("pvtVal","")).split(" ").join(",."),console.log(r),t(r,e).addClass("pvtVal-cross"),t(this).addClass("pvtVal-em")},function(){var r;return r="th ."+t.trim(t(this)[0].className.replace("pvtVal","")).split(" ").join(",."),t(r,e).removeClass("pvtVal-cross"),t(this).removeClass("pvtVal-em")})}}}.call(this),function(){var t,e,r;t=jQuery,r=window.PivotTable,e=r.decorators,e["jquery-ui"]={PivotTable:function(t){return t.addClass("table table-bordered")}}}.call(this),function(){var t,e,r;t=jQuery,r=window.PivotTable,e=r.i18n,e.zh=e["zh-CN"]={"Row Barchart":"行内柱状图",Heatmap:"热点图","Row Heatmap":"行热点图","Col Heatmap":"列热点图","null":"空值",Totals:"合计",None:"无","Select None":"清除选择","Select All":"选择全部","Effects:":"效果:","(too many to list)":"(列表太长)","values for axis":function(t){return"共 "+t[0]+" 类 "+t[1]},"aggregator.count":"计数","aggregator.countUnique":"非重复值计数","aggregator.listUnique":"单行显示非重复值","aggregator.intSum":"累加(取整)","aggregator.sum":"累加","aggregator.average":"平均值","aggregator.sumOverSum":"累加并求比例","aggregator.ub80":"累加并求比例2","aggregator.lb80":"累加并求比例3"}}.call(this),function(){var t,e,r;t=jQuery,e=window.PivotTable,r=e.renderers,t.extend(r,{"Row Barchart":function(t){return e.buildPivotTable(t).barchart()},Heatmap:function(t){return e.buildPivotTable(t).heatmap()},"Row Heatmap":function(t){return e.buildPivotTable(t).heatmap("rowheatmap")},"Col Heatmap":function(t){return e.buildPivotTable(t).heatmap("colheatmap")}}),t.fn.heatmap=function(e){var r,n,a,o,i,s,u,l,c,p=this;switch(null==e&&(e="heatmap"),c=this.data("dimensions"),s=c[0],i=c[1],r=function(t,e,r){var n;return n=function(){switch(t){case"red":return function(t){return"ff"+t+t};case"green":return function(t){return""+t+"ff"+t};case"blue":return function(t){return""+t+t+"ff"}}}(),function(t){var a,o;return o=255-Math.round(255*(t-e)/(r-e)),a=o.toString(16).split(".")[0],1===a.length&&(a=0+a),n(a)}},n=function(e,n){var a,o,i;return o=function(r){return p.find(e).each(function(){var e;return e=t(this).data("value"),null!=e&&isFinite(e)?r(e,t(this)):void 0})},i=[],o(function(t){return i.push(t)}),a=r(n,Math.min.apply(Math,i),Math.max.apply(Math,i)),o(function(t,e){return e.css("background-color","#"+a(t))})},e){case"heatmap":n(".pvtVal","red");break;case"rowheatmap":for(a=u=0;s>=0?s>u:u>s;a=s>=0?++u:--u)n(".pvtVal.row"+a,"red");break;case"colheatmap":for(o=l=0;i>=0?i>l:l>i;o=i>=0?++l:--l)n(".pvtVal.col"+o,"red")}return n(".pvtTotal.rowTotal","red"),n(".pvtTotal.colTotal","red"),this},t.fn.barchart=function(){var e,r,n,a,o,i,s=this;for(i=this.data("dimensions"),a=i[0],n=i[1],e=function(e){var r,n,a,o;return r=function(r){return s.find(e).each(function(){var e;return e=t(this).data("value"),null!=e&&isFinite(e)?r(e,t(this)):void 0})},o=[],r(function(t){return o.push(t)}),n=Math.max.apply(Math,o),a=function(t){return 100*t/(1.4*n)},r(function(e,r){var n,o;return n=r.text(),o=t("<div>").css({position:"relative",height:"55px"}),o.append(t("<div>").css({position:"absolute",bottom:0,left:0,right:0,height:a(e)+"%","background-color":"gray"})),o.append(t("<div>").text(n).css({position:"relative","padding-left":"5px","padding-right":"5px"})),r.css({padding:0,"padding-top":"5px","text-align":"center"}).html(o)})},r=o=0;a>=0?a>o:o>a;r=a>=0?++o:--o)e(".pvtVal.row"+r);return e(".pvtTotal.colTotal"),this}}.call(this);